<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="/JS/qrcode.min.js"></script>

<div class="container p-4" id="conti">
    <div class="row">
        <div class="col-md-4 mx-auto">
            <div class="card text-center">
                <div class="card-header">
                    <h3>
                        Agregar un Nuevo Alumno
                    </h3>
                </div>
                <div class="card-boddy">
                    <img id="login" src="/imagen/clase.jpg" alt="logo Antz"
                        class="card-img-top mx-auto m-2 rounded-circle w-10">
                    <form action="/Alumnos/add" method="POST" enctype="multipart/form-data">
                        <div class="input-group mb-2">
                            <input type="text" id="idAlumno" name="idAlumno" value="{{idAlumno}}"
                                placeholder="Agrega el numero identificador del alumno" class="form-control" autofocus>
                        </div>
                        <div class="input-group mb-2">
                            <input type="text" id="idEscuela" name="idEscuela" value="{{idEscuela}}"
                                placeholder="Identificador de la Escuela" class="form-control">
                        </div>



                        <div class="input-group mb-3">
                            <div id="qrcode" name="codigoQR" class="input-group mb-4">

                            </div>
                            <div>
                                <input type="hidden" name="codQr" id="codQr" value="" placeholder="generador QR"
                                    class="form-control">
                            </div>
                            <div>
                                <input type="button" id="generQr" value="Generar codigo del Alumno"
                                    class="btn btn-success  btn-block">
                            </div>

                        </div>



                        <div class="input-group mb-2">
                            <input type="number" id="nom1" name="grado" value="{{grado}}" min="1" max="20"
                                placeholder="Agrega el grado de la clase" class="form-control">
                            <input type="text" id="nom1" name="grupo" value="{{grupo}}"
                                placeholder="Agrega el grupo de la clase" class="form-control">
                        </div>
                        <div class="input-group mb-2">
                            <input type="email" name="correoTutor" value="{{correoTutor}}"
                                placeholder="Agrega el correo del Tutor" class="form-control">
                        </div>
                        <div class="input-group mb-2">
                            <input type="text" name="nombreTutor" value="{{nombreTutor}}"
                                placeholder="Agrega el Nombre del Tutor" class="form-control">
                        </div>
                        <div class="input-group mb-2">
                            <input type="text" id="nom1" name="nombre" value="{{nombre}}"
                                placeholder="Nombre del Alumno" class="form-control">
                            <input type="text" id="nom1" name="aPaterno" value="{{aPaterno}}"
                                placeholder="Apellido Paterno" class="form-control">
                            <input type="text" id="nom1" name="aMaterno" value="{{aMaterno}}"
                                placeholder="Apellido Materno" class="form-control">
                        </div>
                        <div class="input-group mb-2">
                            <input type="text" id="nom1" name="direccion" value="{{direccion}}"
                                placeholder="Dirección del alumno" class="form-control">
                            <input type="text" id="nom1" name="delegacion" value="{{delegacion}}"
                                placeholder="Delegación o Municipio" class="form-control">
                            <input type="text" id="nom1" name="estado" value="{{estado}}" placeholder="Estado"
                                class="form-control">
                        </div>

                        <div class="input-group mb-2">
                            <button class="btn btn-success btn-block">
                                Guardar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    var Codicade = btoa("");
    var DesCodicade = atob("");
    var encrypted = CryptoJS.AES.encrypt("", "");
    var codgen = "";
    var BtGenera = document.getElementById("generQr");
    document.getElementById('qrcode').innerHTML = "";
    var namCode =document.getElementById('codQr');
    var idAlumno = document.getElementById('idAlumno');
    var idEscuela = document.getElementById('idEscuela');

    function comenzar() {
    //    if(namCode.value!=""){
    //        genera();
    //    }
        BtGenera.addEventListener("click", genera, false);
    }

    function genera() {
        document.getElementById('qrcode').innerHTML = "";
        var qrgene = new QRCode(document.getElementById("qrcode"));
        codgen = idAlumno.value + idEscuela.value;
        encriptar();
        qrgene.makeCode(Codicade);
        document.getElementById('codQr').value = Codicade;
    //    desEncripar()
    }

    function encriptar() {
        var CadEnc = codgen;
        encrypted = CryptoJS.AES.encrypt(CadEnc, "");
        Codicade = btoa(encrypted);
    }

    function desEncripar() {
        var desEnc = Codicade;
        //var desEnc="VTJGc2RHVmtYMThKcytyaWhxVlF5c2NNUWcvOXYvTHN6YVBwODQ5STZXMD0=";
        DesCodicade = atob(desEnc);
        var decrypted = CryptoJS.AES.decrypt(DesCodicade, "");
        console.log("Descode: " + decrypted.toString(CryptoJS.enc.Utf8));
    }

    window.addEventListener('load', comenzar, false)
</script>